machine:
    java:
        version: openjdk7
    environment:
        ANDROID_HOME: /home/ubuntu/android
        JAVA_OPTS: "-Xmx2048m -XX:MaxPermSize=1024m"

dependencies:
    cache_directories:
        - ~/.android
        - ~/android
    override:
        - ./install-dependencies.sh
 
test:
    pre:
        - $ANDROID_HOME/tools/emulator -avd test-target -no-skin -no-audio -no-window -no-boot-anim:
            background: true
            parallel: true
        # - ./wait.sh:
        #     parallel: true
    # override:
    #     - ./gradlew connectedAndroidTestDebug -PdisablePreDex
     post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/target/surefire-reports/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;

deployment:
    develop:
        branch: develop
        commands:
            - ./gradlew assemble
            - ./gradlew crashlyticsUploadDistributionDebug crashlyticsUploadDistributionRelease